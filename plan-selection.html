<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planos MARKAI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        .highlighted-plan {
            border: 3px solid #6b46c1; /* Cor de destaque para o plano recomendado */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            position: relative;
        }

        .highlighted-plan::before {
            content: "Mais Econômico"; /* Seta de destaque */
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #6b46c1;
            color: white;
            padding: 4px 12px;
            font-size: 0.8rem;
            font-weight: bold;
            border-radius: 9999px;
            white-space: nowrap;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <div class="container mx-auto px-4 py-12 min-h-screen flex flex-col justify-center items-center">
        <div id="coupon-section" class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-lg mb-8 transition-all duration-300 ease-in-out hidden">
            <h2 class="text-3xl font-extrabold text-center text-gray-900 mb-4">Possui um cupom?</h2>
            <p class="text-center text-gray-500 mb-6">Digite seu cupom de desconto abaixo.</p>
            <input
                type="text"
                id="coupon-input"
                class="w-full p-4 border border-gray-300 rounded-lg mb-4 text-center uppercase focus:outline-none focus:ring-2 focus:ring-purple-500"
                placeholder="EXEMPLO10"
            >
            <div class="flex flex-col sm:flex-row justify-between gap-4">
                <button
                    id="no-coupon-btn"
                    class="w-full sm:w-1/2 bg-gray-200 text-gray-800 font-bold py-3 px-4 rounded-lg hover:bg-gray-300 transition-colors"
                >
                    Não tenho cupom
                </button>
                <button
                    id="proceed-btn"
                    class="w-full sm:w-1/2 bg-purple-700 text-white font-bold py-3 px-4 rounded-lg hover:bg-purple-800 transition-colors"
                >
                    Prosseguir
                </button>
            </div>
            <p id="coupon-error" class="text-red-500 text-center mt-4 hidden"></p>
        </div>

        <div id="plans-section" class="hidden">
            <div class="text-center mb-10">
                <h1 class="text-4xl font-extrabold text-gray-900 mb-2">Escolha seu plano MARKAI</h1>
                <p class="text-xl text-gray-500 mb-4">Gerencie seu negócio com inteligência. Qual o melhor plano para você?</p>
                <p class="text-lg text-gray-600 font-medium" id="trial-days">7 dias grátis para teste.</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white p-8 rounded-2xl shadow-lg border border-gray-200 hover:shadow-xl transition-shadow">
                        <h3 class="text-2xl font-bold text-purple-700 mb-2">Empresa Mensal</h3>
                        <p class="text-4xl font-extrabold text-green-600 mb-4">R$ 79,90<span class="text-base font-normal text-gray-500">/mês</span></p>
                        <p class="text-gray-600 mb-6">Multi usuários, ideal para negócios com funcionários ou parceiros.</p>
                        <button
                            class="w-full bg-purple-700 text-white font-bold py-3 rounded-lg hover:bg-purple-800 transition-colors"
                            onclick="openCheckout('price_1RUE2EJEPhV4vIDMarwc8vo4', 1)"
                        >
                            Assinar Agora
                        </button>
                        
                        <p class="text-center text-gray-600 mt-4 hidden" id="loading-1">Carregando...</p>
                        <p class="text-center text-red-500 mt-4 hidden" id="error-1"></p>
                    </div>
                    <div class="bg-white p-8 rounded-2xl shadow-lg highlighted-plan">
                        <h3 class="text-2xl font-bold text-purple-700 mb-2">Empresa Anual</h3>
                        <p class="text-4xl font-extrabold text-green-600 mb-4">R$ 786,21<span class="text-base font-normal text-gray-500">/ano</span></p>
                        <p class="text-gray-600 mb-6">Pague de uma vez e economize **18%**.</p>
                        <button
                            class="w-full bg-purple-700 text-white font-bold py-3 rounded-lg hover:bg-purple-800 transition-colors"
                            onclick="openCheckout('price_1RUE3OJEPhV4vIDMzNgVl1jY', 2)"
                        >
                            Assinar Agora
                        </button>
                        <p class="text-center text-gray-600 mt-4 hidden" id="loading-2">Carregando...</p>
                        <p class="text-center text-red-500 mt-4 hidden" id="error-2"></p>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white p-8 rounded-2xl shadow-lg border border-gray-200 hover:shadow-xl transition-shadow">
                        <h3 class="text-2xl font-bold text-purple-700 mb-2">Individual Mensal</h3>
                        <p class="text-4xl font-extrabold text-green-600 mb-4">R$ 39,90<span class="text-base font-normal text-gray-500">/mês</span></p>
                        <p class="text-gray-600 mb-6">Todas as funcionalidades, menos gestão de profissionais.</p>
                        <button
                            class="w-full bg-purple-700 text-white font-bold py-3 rounded-lg hover:bg-purple-800 transition-colors"
                            onclick="openCheckout('price_1S0LeeJEPhV4vIDMAAmSpThi', 3)"
                        >
                            Assinar Agora
                        </button>
                        <p class="text-center text-gray-600 mt-4 hidden" id="loading-3">Carregando...</p>
                        <p class="text-center text-red-500 mt-4 hidden" id="error-3"></p>
                    </div>
                    <div class="bg-white p-8 rounded-2xl shadow-lg border border-gray-200 hover:shadow-xl transition-shadow">
                        <h3 class="text-2xl font-bold text-purple-700 mb-2">Individual Anual</h3>
                        <p class="text-4xl font-extrabold text-green-600 mb-4">R$ 420,00<span class="text-base font-normal text-gray-500">/ano</span></p>
                        <p class="text-gray-600 mb-6">Pague de uma vez e economize **12%**.</p>
                        <button
                            class="w-full bg-purple-700 text-white font-bold py-3 rounded-lg hover:bg-purple-800 transition-colors"
                            onclick="openCheckout('price_1S0LfCJEPhV4vIDMFGZdx4rv', 4)"
                        >
                            Assinar Agora
                        </button>
                        <p class="text-center text-gray-600 mt-4 hidden" id="loading-4">Carregando...</p>
                        <p class="text-center text-red-500 mt-4 hidden" id="error-4"></p>
                    </div>
                </div>
            </div>

            <div class="bg-white p-8 rounded-2xl shadow-lg mt-12 w-full max-w-4xl mx-auto">
                <h2 class="text-3xl font-bold text-purple-700 text-center mb-6">Recursos Inclusos</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-y-4 gap-x-8 text-gray-700">
                    <p class="flex items-center"><span class="text-purple-600 mr-2">✔️</span> Agendamentos Online 24h</p>
                    <p class="flex items-center"><span class="text-purple-600 mr-2">✔️</span> Campanhas de retorno de clientes</p>
                    <p class="flex items-center"><span class="text-purple-600 mr-2">✔️</span> Encaixes com fila de espera automática</p>
                    <p class="flex items-center"><span class="text-purple-600 mr-2">✔️</span> Comissões automáticas</p>
                    <p class="flex items-center"><span class="text-purple-600 mr-2">✔️</span> Criação de cupons para engajamento</p>
                    <p class="flex items-center"><span class="text-purple-600 mr-2">✔️</span> Cadastro e venda de produtos</p>
                    <p class="flex items-center"><span class="text-purple-600 mr-2">✔️</span> Clube do assinante</p>
                    <p class="flex items-center"><span class="text-purple-600 mr-2">✔️</span> Mercado Pago Integrado</p>
                    <p class="flex items-center"><span class="text-purple-600 mr-2">✔️</span> App ou link personalizado para clientes</p>
                    <p class="flex items-center"><span class="text-purple-600 mr-2">✔️</span> Gráficos com Métricas</p>
                    <p class="flex items-center"><span class="text-purple-600 mr-2">✔️</span> Cadatros de clientes, profissionais e fornecedores</p>
                    <p class="flex items-center"><span class="text-purple-600 mr-2">✔️</span> Diversas notificações automáticad</p>
                    <p class="flex items-center"><span class="text-purple-600 mr-2">✔️</span> Lembrete de agendamento com confirmação</p>
                    <p class="flex items-center"><span class="text-purple-600 mr-2">✔️</span> Prontuários e Depoimentos</p>
                    <p class="flex items-center"><span class="text-purple-600 mr-2">✔️</span> Cartão Fidelidade</p>
                    <p class="flex items-center"><span class="text-purple-600 mr-2">✔️</span> Pesquisa de Satisfação</p>
                    <p class="flex items-center"><span class="text-purple-600 mr-2">✔️</span> WhatsApp integrado</p>
                    <p class="flex items-center"><span class="text-purple-600 mr-2">✔️</span> E muito mais...</p>
                </div>
            </div>

            <div class="mt-8 text-center">
                <button
                    class="w-full sm:w-auto bg-gray-100 text-purple-700 font-bold py-3 px-6 rounded-lg border-2 border-purple-700 hover:bg-gray-200 transition-colors"
                    onclick="window.location.href='index.php'"
                >
                    ← Voltar para página principal
                </button>
            </div>
        </div>
    </div>
    <script>
        const API_BASE_URL = 'https://markai.skysee.com.br/api';
        let coupon = '';
        let trialDays = 7;

        // Mostrar seção de cupom inicialmente
        document.getElementById('coupon-section').classList.remove('hidden');

        // Função para validar cupom
        document.getElementById('proceed-btn').addEventListener('click', async () => {
            const couponInput = document.getElementById('coupon-input').value.trim().toUpperCase();
            const couponError = document.getElementById('coupon-error');
            
            // Mostra um spinner de carregamento no botão
            const proceedBtn = document.getElementById('proceed-btn');
            proceedBtn.textContent = 'Verificando...';
            proceedBtn.disabled = true;

            if (!couponInput) {
                couponError.textContent = 'Por favor, insira um cupom.';
                couponError.classList.remove('hidden');
                proceedBtn.textContent = 'Prosseguir';
                proceedBtn.disabled = false;
                return;
            }

            try {
                const response = await fetch(`validate-coupon.php`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ coupon: couponInput })
                });

                const data = await response.json();
                if (!response.ok) {
                    throw new Error(data.error || 'Erro ao validar cupom');
                }

                coupon = couponInput;
                trialDays = data.trialDays || 30;
                
                document.getElementById('coupon-section').classList.add('hidden');
                document.getElementById('plans-section').classList.remove('hidden');
                document.getElementById('trial-days').textContent = `${trialDays} dias grátis para teste.`;
                
                // Exibe um alerta de sucesso
                Swal.fire({
                    icon: 'success',
                    title: 'Cupom Aplicado!',
                    text: 'Seu período de teste foi estendido. Aproveite!',
                    timer: 3000,
                    showConfirmButton: false
                });
                
            } catch (err) {
                couponError.textContent = err.message || 'Cupom não existente.';
                couponError.classList.remove('hidden');
            } finally {
                proceedBtn.textContent = 'Prosseguir';
                proceedBtn.disabled = false;
            }
        });

        // Função para prosseguir sem cupom
        document.getElementById('no-coupon-btn').addEventListener('click', () => {
            coupon = '';
            trialDays = 7;
            document.getElementById('coupon-section').classList.add('hidden');
            document.getElementById('plans-section').classList.remove('hidden');
            document.getElementById('trial-days').textContent = '7 dias grátis para teste.';
        });

        // Função para abrir checkout
        async function openCheckout(priceId, planIndex) {
            const loadingElement = document.getElementById(`loading-${planIndex}`);
            const errorElement = document.getElementById(`error-${planIndex}`);

            if (!loadingElement || !errorElement) {
                console.error(`Elementos loading-${planIndex} ou error-${planIndex} não encontrados`);
                Swal.fire({
                    icon: 'error',
                    title: 'Erro',
                    text: 'Erro interno. Tente novamente mais tarde.'
                });
                return;
            }

            loadingElement.classList.remove('hidden');
            errorElement.classList.add('hidden');

            try {
                const response = await fetch(`create-checkout-session.php`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ priceId, coupon: coupon || null })
                });

                const data = await response.json();
                if (!response.ok) {
                    throw new Error(data.error || `Erro na requisição: ${response.status}`);
                }

                if (data.url) {
                    window.location.href = data.url;
                } else {
                    throw new Error('URL de checkout não retornada');
                }
            } catch (err) {
                errorElement.textContent = `Erro: ${err.message}`;
                errorElement.classList.remove('hidden');
                Swal.fire({
                    icon: 'error',
                    title: 'Erro no Checkout',
                    text: err.message
                });
            } finally {
                loadingElement.classList.add('hidden');
            }
        }
    </script>
</body>
</html>
